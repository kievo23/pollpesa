<!DOCTYPE HTML>
<html>
    <head>        
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-9965055906014205",
            enable_page_level_ads: true
          });
        </script>
        <title>PollPesa | {{title}}</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Play and support your favourite candidate in Kenya today. more then 1000 different bets including multibets. See if your favourite president is winning. Your Vote counts.">
        <meta name="author" content="Kelvin Chege M">
        <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
        <link href="/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/ie8.css" />
        <link rel="stylesheet" href="/css/ie9.css" />
        <link href="/css/jquery.dataTables.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/font-awesome.min.css" />
        <link rel="stylesheet" href="/css/style.css" /> 
        <link rel="stylesheet" href="/css/responsive.dataTables.min.css">
        <link rel="icon" href="/images/pollpesa.png" type="image/x-icon">
        <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
        <!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
    </head>
    <body>
        <div id="butterfly">
        <div class="topper">
            <nav class="navbar navbar-default navbar-static-top no_margin" style="padding-left: 10px;padding-right: 10px;">
                <div class="navbar-header">

                    <!-- Collapsed Hamburger -->
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#app-navbar-collapse">
                        <span class="sr-only">Toggle Navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                    <!-- Branding Image -->
                    <a class="navbar-brand" href="/">
                    <img src="images/logo.png" width="100px"> 
                    </a>
                </div>

                <div class="collapse navbar-collapse" id="app-navbar-collapse">
                    <!-- Left Side Of Navbar -->
                    <ul class="nav navbar-nav">
                        &nbsp;
                    </ul>

                    <!-- Right Side Of Navbar -->
                    <ul class="nav navbar-nav navbar-right">
                        <!-- Authentication Links -->
                            {{#if user}}
                            <li><a href="#"><strong>Credits: <span id="credits">{{user.credits}}</span></strong></a></li>
                            <li><a href="/logout">Logout</a></li>
                            {{else}}
                            <li>
                                <form class="form-inline" method="post" action="/login">
                                  <div class="form-group">
                                    <label class="sr-only" for="exampleInputEmail3">Email address</label>
                                    <input type="text" class="form-control" id="username" name="username" placeholder="Phone">
                                  </div>
                                  <div class="form-group">
                                    <label class="sr-only" for="exampleInputPassword3">Password</label>
                                    <input type="password" name="password" class="form-control" id="password" placeholder="Password">
                                  </div>
                                  <button type="submit" class="btn btn-warning">Sign in</button>
                                </form>
                            </li>

                            <li><a href="/register">Sign Up</a></li>
                            {{/if}}
                    </ul>
                </div>
            </nav>
        </div>
        <div id="betmobileslip" style="position:fixed;top:0;right:0;padding:5px;z-index:1000;display:block; background:#f5f5f5;" v-if="candidates.length > 0" >
            <a href="#betslip" style=""><i class="fa fa-bitcoin" aria-hidden="true"></i>Bet Slip
                    <div class="badge">\{{candidates.length}}</div>
            </a>
        </div>
        <div class="topper secondtopper">
            <nav class="navbar navbar-default navbar-static-top no_margin" style="padding-left: 10px;padding-right: 10px;background-color: #CFB681;">
                <div class="navbar-toggle collapsed">
                        <ul class="nav navbar-nav">
                            <li>
                                <a href="/"><i class="fa fa-home" aria-hidden="true"></i> Home</a>
                            </li>
                            <li>
                                    <a href="/#news" aria-controls="news" role="tab" data-toggle="tab"><i class="fa fa-globe" aria-hidden="true"></i> News</a>
                            </li>
                            <li v-if="candidates.length > 0">
                                <a href="#betslip"><i class="fa fa-bitcoin" aria-hidden="true"></i>Bet Slip
                                        <div class="badge">\{{candidates.length}}</div>
                                </a>
                            </li>
                            
                        </ul>

                    </div>

                <div class="collapse navbar-collapse" id="app-navbar2-collapse">

                    <!-- Left Side Of Navbar -->
                    <ul class="nav navbar-nav">
                        <li>
                                <a href="/"><i class="fa fa-home" aria-hidden="true"></i> Home</a>
                        </li>
                        <li>
                                <a href="/#news" aria-controls="news" role="tab" data-toggle="tab"><i class="fa fa-globe" aria-hidden="true"></i> News</a>
                        </li>
                        <li v-if="candidates.length > 0">
                                <a href="#betslip"><i class="fa fa-bitcoin" aria-hidden="true"></i>Bet Slip
                                        <div class="badge">\{{candidates.length}}</div>
                                </a>
                            </li>
                    </ul>

                    <!-- Right Side Of Navbar -->
                    <ul class="nav navbar-nav navbar-right">
                        <!-- Authentication Links -->
                             <li>
                                <a href="http://fb.me/PollPesa/"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                            </li>
                            <li>
                                <a href="http://twitter.com/PollPesaKenya"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                            </li>
                            <li>
                                <a href="http://www.instagram.com/pollpesa"><i class="fa fa-instagram" aria-hidden="true"></i></a>
                            </li>
                            <li>
                                <a href="http://m.me/PollPesa"><i class="fa fa-phone" aria-hidden="true"></i> Help & Support</a>
                            </li>

                    </ul>
                </div>
        </nav>
        </div>
        <div class="row designer no_padding">
            <div id="header" class="col-md-2 col-sm-12 no_padding">

                <div class="top" style="padding-left: 30px;">

                    <!-- Logo -->
                        <div id="logo" style="color:#b39e2c">
                            {{#if user}}
                            <h1 id="title">{{user.names}}</h1>
                            <p>Blue Belt</p>
                            {{else}}
                            <h1>PollPesa</h1>
                            <p>Quickly Place a bet</p>
                            {{/if}}
                        </div>

                    <!-- Nav -->
                        <nav id="nav">
                            <!--

                                Prologue's nav expects links in one of two formats:

                                1. Hash link (scrolls to a different section within the page)

                                   <li><a href="#foobar" id="foobar-link" class="icon fa-whatever-icon-you-want skel-layers-ignoreHref"><span class="label">Foobar</span></a></li>

                                2. Standard link (sends the user to another page/site)

                                   <li><a href="http://foobar.tld" id="foobar-link" class="icon fa-whatever-icon-you-want"><span class="label">Foobar</span></a></li>

                            -->
                            <ul style="list-style-type: none;padding:0px">
                                <li><a href="/" id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home"> Home</span></a></li>           
                                <li><a href="/counties" id="candidate-link" class="skel-layers-ignoreHref"><span class="icon fa-bug">  Counties</span></a></li>
                                {{#if user}}
                                <li><a href="/bet" id="portfolio-link" class="skel-layers-ignoreHref"><span class="icon fa-th"> Bets 
                                    {{#if betCount}}
                                        <div class="badge">{{betCount}}</div>
                                    {{/if}}
                                </span></a></li>
                                {{#if user.role}}
                                                     
                                <li><a href="/candidate" id="candidate-link" class="skel-layers-ignoreHref"><span class="icon fa-users"> Candidates</span></a></li>
                                <li><a href="/candidate/create" id="candidate-link" class="skel-layers-ignoreHref"><span class="icon fa-users">New Candidate</span></a></li>
                                <li><a href="/region#region" id="region-link" class="skel-layers-ignoreHref"><span class="icon fa-bullseye">Region</span></a></li>  
                                <li><a href="/category#category" id="category-link" class="skel-layers-ignoreHref"><span class="icon fa-certificate">Category</span></a></li>
                                <li><a href="/users" id="region-link" class="skel-layers-ignoreHref"><span class="icon fa-bullseye"> Users</span></a></li>
                                <li><a href="/news" id="region-link" class="skel-layers-ignoreHref"><span class="icon fa-bullseye"> News</span></a></li>
                                <li><a href="/poll" id="region-link" class="skel-layers-ignoreHref"><span class="icon fa-bullseye"> Polls</span></a></li>
                                <li><a href="#about" id="about-link" class="skel-layers-ignoreHref"><span class="icon fa-user"> About</span></a></li>    
                                 {{/if}}                           
                                <li><a href="/logout" id="logout" class="skel-layers-ignoreHref"><span class="icon fa-sign-out"> Logout</span></a></li>
                                {{else}}
                                
                                {{/if}}
                            </ul>
                        </nav>

                </div>

                <div class="bottom">

                    <!-- Social Icons -->
                        <ul class="icons" style="list-style-type: none;">
                            <li><a href="http://twitter.com/PollPesaKenya" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
                            <li><a href="http://fb.me/PollPesa/" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
                            <li><a href="http://m.me/PollPesa/" class="icon fa-call"><span class="label">Facebook Messenger</span></a></li>
                        </ul>

                </div>

            </div>
            
        <!-- Main -->
            <div id="main" class="col-md-10 col-sm-12 no_padding">
                <!-- Intro -->
                    <section id="{{id}}" class="oned">
                        <div class="panel  text-center col-md-11"><h4>Play and support your favourite candidate in Kenya today. More than 1000 different bets including multibets. See if your favourite president is winning. Your Vote counts. </h4>
                        <img src="images/parties/proudly-kenyan.png" width="80px">
                        <h6>Peaceful Kenyan Elections in August 2017. We are One</h6></div>
                        <adsensediv></adsensediv>
                            {{#if errors}}
                                {{#each errors}}
                                    <div class="alert alert-danger">{{msg}}</div>
                                {{/each}}
                            {{/if}}
                            {{#if message}}     
                                    <div class="alert alert-info">{{message}}</div>
                            {{/if}}
                            {{#if success_msg}}     
                                    <div class="alert alert-success">{{success_msg}}</div>
                            {{/if}}
                            {{#if error_msg}}     
                                    <div class="alert alert-danger">{{error_msg}}</div>
                            {{/if}}
                            {{#if error}}     
                                    <div class="alert alert-danger">{{error}}</div>
                            {{/if}}
                            <div id="detail" style="margin-top: 10px;">
                                {{{body}}}  
                                <br>
                                
                            </div>
                            <input type="hidden" name="role" value="{{user.role}}">
                    </section>

                </div>
            </div>

            
        <!-- Footer -->
            <div id="footer">

                <!-- Copyright -->
                    <ul class="copyright">
                        <li>&copy; Pollpesa 2017. All rights reserved.</li>
                    </ul>

            </div>
          
            
                
        </div> 
        <script type="text/x-template" id="modal-template">
                  <transition name="modal">
                    <div class="modal-mask">
                      <div class="modal-wrapper">
                        <div class="modal-container">

                          <div class="modal-header">
                            <slot name="header">
                              default header
                            </slot>
                          </div>

                          <div class="modal-body">
                            <slot name="body">
                              
                            </slot>
                          </div>

                          <div class="modal-footer">
                            <slot name="footer">
                              <button class="btn btn-default modal-default-button" @click="$emit('close')">
                                close
                              </button>
                            </slot>
                          </div>
                        </div>
                      </div>
                    </div>
                  </transition>
                </script>   
              <script type="text/x-template" id="adsense">
                <div class="statistics">
                  <ins class="adsbygoogle" id="" 
                     style="display:inline-block;width:728px;height:90px"
                     data-ad-client="ca-pub-9965055906014205"
                     data-ad-slot="9252745178"></ins>
                </div>
              </script>
              <script type="text/x-template" id ="county-template">
                 <table id="county" cellspacing="0" width="100%" class="display table table-hover table-condensed table-responsive candidates">
                    <thead>
                       <tr>
                          <th>Name</th>
                          <th>Position</th>
                          <th>Region</th>
                          <th>Odd</th>
                       </tr>
                    </thead>
                    <tfoot>
                       <tr>
                          <th>Name</th>
                          <th>Position</th>
                          <th>Region</th>
                          <th>Odd</th>
                       </tr>
                    </tfoot>
                 </table>
              </script>
              <script type="text/x-template" id ="constituency-template">
                 <table id="constituency" cellspacing="0" width="100%" class=" display table table-hover table-condensed table-responsive candidates">
                    <thead>
                       <tr>
                          <th>Name</th>
                          <th>Position</th>
                          <th>Region</th>
                          <th>Odd</th>
                       </tr>
                    </thead>
                    <tfoot>
                       <tr>
                          <th>Name</th>
                          <th>Position</th>
                          <th>Region</th>
                          <th>Odd</th>
                       </tr>
                    </tfoot>
                 </table>
              </script>
        <!-- Scripts -->
            <script src="/js/vue.js"></script>
            <script src="/js/jquery-1.12.4.min.js"></script>

            <!-- Bootstrap Core JavaScript -->
            <script src="/js/bootstrap.min.js"></script> 
            <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
            <script src="/js/lodash.min.js"></script>
            <script src="/js/jquery.dataTables.min.js"></script>
            <script src="/js/dataTables.responsive.js"></script>
            <script src="/js/skel.min.js"></script>
            <script src="/js/tinymce.min.js"></script>
            <script src="/js/handlebars-v4.0.5.js"></script>
            <script src="/js/util.js"></script> <script type="text/javascript">
                tinymce.init({ 
                    selector:'textarea',
                    height: 250,
                      menubar: false,
                      plugins: [
                        'advlist autolink lists link image charmap print preview anchor',
                        'searchreplace visualblocks code fullscreen',
                        'insertdatetime media table contextmenu paste code'
                      ],
                      toolbar: 'undo redo | insert | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image',
                      content_css: '//www.tinymce.com/css/codepen.min.css'
                });

                $(document).ready(function(){
                    $('.candidates').DataTable({
                        "order": [[ 3, "asc" ]],
                        responsive: true
                    });

                    $('.presidents').DataTable({
                        "order": [[ 0, "desc" ]],
                        responsive: true
                    });

                    $('.bets').DataTable({
                        "order": [[ 3, "desc" ]],
                        responsive: true
                    } );
                    (function(){
                        var source   = "<p>{{lastName}}, {{firstName}}</p>";
                        var template = Handlebars.compile(source);
                        console.log(template({firstName: "Alan", lastName: "Johnson"}));
                    })();

                    $role=$('#role').val();
                    if($role != 1){
                        $('.isEdit').addClass("hide");
                    }
                });

                
            </script>    
        <script>
                
                function shuffle(array) {
                  var currentIndex = array.length, temporaryValue, randomIndex;

                  // While there remain elements to shuffle...
                  while (0 !== currentIndex) {

                    // Pick a remaining element...
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex -= 1;

                    // And swap it with the current element.
                    temporaryValue = array[currentIndex];
                    array[currentIndex] = array[randomIndex];
                    array[randomIndex] = temporaryValue;
                  }

                  return array;
                }

                Vue.component('county',{
                    template: '#county-template',
                    props: ['county'],
                    ready: function(){
                        this.$parent.county();
                    }
                });

                Vue.component('constituency',{
                    template: '#constituency-template',
                    methods: {

                    }
                });

                Vue.component('adsensediv',{
                    template: '#adsense',
                });
                Vue.component('modal', {
                  template: '#modal-template',
                });
                var app = new Vue({
                    el: '#butterfly',
                    data: {
                        cid: [],
                        msg: 'Welcome',
                        candidates: [],
                        price: 100,
                        showModal: false,
                        showProcess: false,
                        showResult: false,
                        betId: 0,
                        details: [],
                        prop: 'one',
                        result: '',
                        rstimage: '',
                        userId: '',
                        cands: {}
                    },
                    ajaxRequest() {
                        //this should push into your components array
                        // example:
                        /*$.ajax().done(function(data) {
                            this.components.push(data);
                        })*/
                    },
                    mounted: function(){
                        console.log("this part!");
                        this.constituency();
                        this.county();
                        (window.adsbygoogle = window.adsbygoogle || []).push({});
                    },
                    computed: {
                        totalAmount : function(){
                            var amount = 0;
                            for (var i = this.candidates.length - 1; i >= 0; i--) {
                                amount += parseFloat(this.candidates[i].odd);
                            }
                            return parseInt(amount * this.price);
                        },

                    },
                    updated: function(){
                        this.constituency();
                        this.county();
                    },
                    methods: {
                        addToPrez: function(value){
                            alert(value);
                            console.log(value);
                            this.cid.push(value);
                        },
                        election: function(betId){
                            var app = this;
                            this.showProcess=true;
                            axios.post('/bet/compute',{
                                betId: betId
                            }).then(function(response){
                                app.showProcess=false;
                                app.showResult=true;
                                if(response.data==1){
                                    app.rstimage = "images/win2.gif";
                                    app.result = "Congratulations you won!!";
                                }else if(response.data==0){
                                    app.rstimage = "images/loss.gif";
                                    app.result = "Sorry, try again";
                                }else{
                                    app.result = "Already run";
                                }
                            });
                        },
                        probfunction: function(){                            
                            var arrayNum = [];
                            for (var i = 10 - 1; i >= 0; i--) {
                                arrayNum.push('wanjiru');
                            } 
                            for (var i = 80 - 1; i >= 0; i--) {
                                arrayNum.push('Sonko');
                            } 
                            for (var i = 10 - 1; i >= 0; i--) {
                                arrayNum.push('Kidero');
                            }  
                            arrayNum = shuffle(arrayNum);
                            var singleRandom = arrayNum[Math.floor(Math.random() * arrayNum.length)];
                            this.prop = singleRandom;
                        },
                        modal: function(betId){
                            this.betId = betId;
                            this.showModal=true;
                            var app = this;
                            axios.post('/bet/fetch', {
                                betId: betId
                              })
                              .then(function (response) {
                                console.log(response.data);
                                app.details = response.data;
                              })
                              .catch(function (error) {
                                console.log(error);
                              });
                        },
                        candidate: function(){
                            var app = this;
                            axios.post('/users/fetch', {
                                candidates: app.cid
                              })
                              .then(function (response) {
                                app.candidates = response.data;
                              })
                              .catch(function (error) {
                                console.log(error);
                              });
                        },
                        placeBet: function(){
                            var ap = this;
                            axios.post('/bet/place', {
                                candidates: ap.cid,
                                price: ap.price
                              })
                              .then(function (response) {
                                console.log(response.body);
                              })
                              .catch(function (error) {
                                console.log(error);
                              });
                        },
                        county: function(){
                            var ap = this;
                            $('#county').DataTable( {
                                "ajax": '/candidate/county',
                                "columns": [
                                    { "data": "name" },
                                    { "data": "position" },
                                    { "data": "region",
                                        render: function(data, type, row){
                                            return  data.name;
                                        }
                                    },
                                    { "data": "odd",
                                        render: function(data, type, row){
                                            return '<div id="ck-button"><label><input type="checkbox" id="cid" name="cid" value="2"><span>'+ data +' Bet</span></label></div>';
                                        }
                                    }
                                ]
                            });
                        },
                        constituency: function(){
                            var ap = this;
                            $('#constituency').DataTable( {
                                "ajax": "/candidate/constituency",
                                "columns": [
                                    { "data": "name" },
                                    { "data": "position" },
                                    { "data": "region",
                                        render: function(data, type, row){
                                            return  data.name;
                                        }
                                    },
                                    { "data": "odd",
                                        render: function(data, type, row){
                                            return '<div id="ck-button"><label><input type="checkbox" id="cid" name="cid" value="2"><span>'+ data +' Bet</span></label></div>';
                                        }
                                    }
                                ]
                            });
                        },
                    }
                });

                
                
        </script>
    </body>
</html>